@page "/"
@using Goldlight.Blazor.VirtualServer.Api
@using Goldlight.Blazor.VirtualServer.Models

@inject OrganizationApi OrganizationApi
<PageTitle>Projects</PageTitle>

<MudDataGrid T="Project" Items="projects" Hover="true" QuickFilter="QuickFilterFunc">
  <ToolBarContent>
    <MudText Typo="Typo.h6">Projects</MudText>
    <MudSpacer/>
    <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
                  AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0" />
    
  </ToolBarContent>
  <Columns>
    <PropertyColumn Property="x => x.Name" Title="Name"/>
    <PropertyColumn Property="x => x.FriendlyName" Title="Friendly name"/>
    <TemplateColumn Title="Base URL">
      <CellTemplate>
        <DataContainer HasData="organization != null">
          <DataTemplate>
            <MudText>http://localhost:5601/@organization!.Id/@context.Item.FriendlyName</MudText>
          </DataTemplate>
        </DataContainer>
      </CellTemplate>
    </TemplateColumn>
  </Columns>
</MudDataGrid>
<MudButton Href="/projects/addproject" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" Class="mt-2">Add project</MudButton>

@code {

  private readonly Projects projects = new();
  private ExtendedOrganization? organization;
  private string? searchString;

  protected override async Task OnInitializedAsync()
  {
    organization = await OrganizationApi.GetOrganizationAsync("goldlight");
  }


  private Func<Project, bool> QuickFilterFunc => row => string.IsNullOrWhiteSpace(searchString) || row.Name.Contains(searchString, StringComparison.OrdinalIgnoreCase) || row.FriendlyName.Contains(searchString, StringComparison.OrdinalIgnoreCase);

}
